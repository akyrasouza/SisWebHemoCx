<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Medilab Bootstrap Template - Index</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
    * Template Name: Medilab
    * Updated: Sep 18 2023 with Bootstrap v5.3.2
    * Template URL: https://bootstrapmade.com/medilab-free-medical-bootstrap-theme/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>

<body>
  <!-- ======= Cadastro Section ======= -->
  <section id="cadastro" class="cadastro">
    <div class="container">

      <div class="section-title">
        <h2>Cadastro</h2>
        <p>Magnam dolores commodi suscipit. Necessitatibus eius consequatur ex aliquid fuga eum quidem. Sit sint
          consectetur velit. Quisquam quos quisquam cupiditate. Et nemo qui impedit suscipit alias ea. Quia fugiat sit
          in iste officiis commodi quidem hic quas.</p>
      </div>

      <div class="row">
        <!-- <div class="col-lg-6">
            <div class="member d-flex align-items-start">
              <div class="pic"><img src="assets/img/doctors/doctors-1.jpg" class="img-fluid" alt=""></div>
              <div class="member-info">
                <h4>Walter White</h4>
                <span>Chief Medical Officer</span>
                <p>Explicabo voluptatem mollitia et repellat qui dolorum quasi</p>
                <div class="social">
                  <a href=""><i class="ri-twitter-fill"></i></a>
                  <a href=""><i class="ri-facebook-fill"></i></a>
                  <a href=""><i class="ri-instagram-fill"></i></a>
                  <a href=""> <i class="ri-linkedin-box-fill"></i> </a>
                </div>
              </div>
            </div>
          </div> -->

        <div class="container">
          <form novalidate="false" id="formEtapa">
            <!--Etapa 1-->
            <div class="form-group" id="etapa1">
              <div class="row g-3">
                <!--Nome-->
                <div class="col-md-4">

                  <label class="form-label" for="nome">*Nome Completo</label>
                  <input type="text" class="form-control" id="nome" name="nomeCompleto" required>
                </div>
                <!--CPF-->
                <div class="col-md-2">
                  <label class="form-label" for="cpf">*CPF</label>
                  <input type="text" class="form-control" id="cpf" placeholder="000.000.000-00" required>
                </div>
                <!--Data Nascimento-->
                <div class="col-md-3">
                  <label class="form-label" for="data_nasc">*Data de Nascimento</label>
                  <input type="text" class="form-control centered" id="dataNascimento" placeholder="____/____/____" required>
                </div>
                <!--Sexo-->
                <div class="col-md-2">
                  <label class="form-label" for="sexo">*Sexo</label>
                  <select class="form-select" id="sexo" required>
                    <option selected value="F">
                      FEMENINO
                    </option>

                    <option value="M">
                      MASCULINO
                    </option>
                  </select>
                </div>
                <!--Nome Mae-->
                <div class="col-md-4">
                  <label class="form-label" for="nomeMae">*Nome da Mãe</label>
                  <input type="text" class="form-control" id="nomeMae" required>
                </div>
                <!--Telefone-->
                <div class="col-md-2">
                  <label class="form-label" for="telefone">*Telefone</label>
                  <input type="text" class="form-control" id="telefone" placeholder="(DD)900-0000" required>
                </div>
                <div class="col-1"></div>
                <!--Tipo Sanguineo Dropdown-->
                <div class="col-md-2">
                  <label class="form-label" for="tipoSanguineo">*Tipo Sanguíneo</label>
                  <select class="form-select" id="tipoSanguineo" required>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="AB">AB</option>
                    <option value="O">O</option>
                  </select>
                </div>
                <!--Fator RH Dropdown-->
                <div class="col-md-2">
                  <label class="form-label" for="ft_rh">*Fator RH</label>
                  <select class="form-select" id="fatorRH" required>
                    <option value="POSITIVO">POSITIVO</option>
                    <option value="NEGATIVO">NEGATIVO</option>
                  </select>
                </div>

                <!--Email e senha-->
                <div class="col-md-4">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" required>
                </div>
                <div class="col-md-2">
                  <label for="senha" class="form-label">Senha</label>
                  <div id="container_icon">
                    <input type="password" class="form-control " id="senha" min="8" max="16" required>
                    <i class="bi bi-eye olho" onclick="mouseoverPass();" onmouseout="mouseoutPass();" id="olho"></i>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-primary mt-3" onclick="proximaEtapa(2)">Próxima</button>
            </div>
            <!--Etapa 2-->
            <div class="form-group" id="etapa2" style="display: none;">
              <div class="row g-3">
                <!--CEP-->
                <div class="col-md-4">
                  <label for="cep" class="form-label">*Cep</label>
                  <input type="text" class="form-control" id="cep" pattern="^[0-9]+$" title="Digite apenas números de 0 a 9" oninput="buscarCep(this)" minlength="8" maxlength="8" required>
                </div>
                <!--Endereco-->
                <div class="col-md-4">
                  <label for="endereco" class="form-label">*Endereço</label>
                  <input type="text" class="form-control" id="endereco" required>
                </div>
                <!--Número-->
                <div class="col-md-4">
                  <label for="numero" class="form-label">*Número</label>
                  <input type="text" class="form-control" id="numero" placeholder="Digite números ou 'SN'" required>
                </div>
                <!--Estado-->
                <div class="col-md-1">
                  <label for="uf" class="form-label">*Estado</label>
                  <input type="text" class="form-control" id="uf" required>
                </div>
                <!--Cidade-->
                <div class="col-md-2">
                  <label for="localidade" class="form-label">*Cidade</label>
                  <input type="text" class="form-control" id="localidade" required>
                </div>
                <!--Bairro-->
                <div class="col-md-4">
                  <label for="bairro" class="form-label">*Bairro</label>
                  <input type="text" class="form-control" id="bairro" required>
                </div>
                <!--Complemento-->
                <div class="col-md-4">
                  <label for="complemento" class="form-label">Complemento</label>
                  <input type="text" class="form-control" id="complemento">
                </div>
              </div>
              <button type="button" class="btn btn-secondary mt-5" onclick="etapaAnterior(1)">Anterior</button>
              <button type="button" class="btn btn-success mt-5 ms-4" onclick="validarUltimaEtapa()">Enviar</button>
            </div>

        </div>
        </form>
      </div>
    </div>
    </div>
  </section><!-- End Doctors Section -->
  <!-- Vendor JS Files -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>


  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <!--Etapas Formulario-->
  <script>
    const formEl = document.getElementById('formEtapa');

    $('.dropdown-toggle').dropdown();
    let etapaAtual = 1;

    // PREENHER DADOS
    (() => {
      const modelo = {
        "nome": "Nome Teste 3",
        "cpf": "123.652.506-02",
        "dataNascimento": "12-04-1998",
        "sexo": "F",
        "nomeMae": "Nome da mãe",
        "telefone": "(98) 98456-1245",
        "tipoSanguineo": "A",
        "fatorRH": "POSITIVO",
        "email": "email3@fake-gmail.com",
        "senha": "12345678"
        //   "cep": "01001000",
        //   "endereco": "Rua 1",
        //   "numero": "13",
        //   "uf": "MA",
        //   "localidade": "Ciade",
        //   "bairro": "Bairro 1",
        //   "complemento": "Casa"
      };

      Object.entries(modelo).forEach(([key, value]) => {
        if (formEl.elements[key]) {
          formEl.elements[key].value = value;
        }
      });
    }
    )();

    function proximaEtapa(etapa) {
      const camposValidos = validarCamposEtapa(etapaAtual);

      if (!camposValidos) {
        alert("Preencha todos os campos obrigatórios na etapa atual.");
        return;
      }
      document.getElementById('etapa' + etapaAtual).style.display = 'none';
      document.getElementById('etapa' + etapa).style.display = 'block';
      etapaAtual = etapa;
    }

    function etapaAnterior(etapa) {
      document.getElementById('etapa' + etapaAtual).style.display = 'none';
      document.getElementById('etapa' + etapa).style.display = 'block';
      etapaAtual = etapa;
    }
    function validarCamposEtapa(etapa) {
      const camposEtapa = document.querySelectorAll(`#etapa${etapa} input[required]`);

      for (const campo of camposEtapa) {
        if (!campo.value) {
          return false;
        }
      }

      return true;
    }

    async function enviarRelatorio() {
      // Recolha os dados do formulário ou crie um objeto de dados do relatório
      const body = {};
      Array.from(formEl.elements).forEach(element => {
        if (element?.id && element?.value) {
          body[element.id] = element.value;
        }
      });

      await fetch('http://26.49.188.195:8080/usuarios', {
        method: 'POST',
        body: JSON.stringify(body),
        headers: {
          "Content-Type": "application/json"
        }
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error('Erro', { cause: response.json() });
          }
          return response.json();
        })
        .then(data => {
          showMessage({
            text: "Relatório enviado com sucesso!",
            className: "success-toast",

            // REDIRECIONAR PARA INDEX
            onClick: function () {
              const a = document.createElement('a');
              a.href = "./login.html";
              a.click();
            }
          });
        })
        .catch((e) => {
          e.cause.then((data) => {
            showMessage({
              text: data?.mensagem || data?.message || data?.titulo || 'Sistema indisponível no momento. Por favor, tente mais tarde.',
              className: "error-toast",
            });
          });
        });

    }

    function validarUltimaEtapa() {
      const camposValidos = validarCamposEtapa(etapaAtual);
      if (!camposValidos) {
        alert("Preencha todos os campos obrigatórios na última etapa.");
        return;
      }

      //alert('enviando relatorio');
      enviarRelatorio();
    }

    const showMessage = (options) => {
      Toastify({
        duration: 30_000,
        close: true,
        gravity: "top",
        position: "right",
        stopOnFocus: true,
        ...options
      }).showToast();
    } 
  </script>

  <!--Via CEP-->
  <script>
    function buscarCep(input) {
      input.value = input.value.replace(/[^0-9]/g, "");
      if (input.value.length == 8) {

        var url = 'https://viacep.com.br/ws/' + input.value + '/json/';

        $.ajax({
          url: url,
          dataType: 'json',
          success: function (data) {
            $('#endereco').val(data.logradouro);
            $('#bairro').val(data.bairro);
            $('#localidade').val(data.localidade);
            $('#uf').val(data.uf);
          }
        });
      };
    };
  </script>

  <!--Máscaras Input-->
  <script>
    $(document).ready(function () {
      $('#cpf').mask('000.000.000-00', { reverse: true });
    });

    $(document).ready(function () {
      $('#dataNascimento').mask('00-00-0000');
    });

    $(document).ready(function () {
      $('#tel').mask('(00)000-0000');
    });
  </script>

  <!--Icone Senha-->
  <script>
    function mouseoverPass(obj) {
      var obj = document.getElementById('senha');
      obj.type = "text";
    }
    function mouseoutPass(obj) {
      var obj = document.getElementById('senha');
      obj.type = "password";
    }
  </script>

</body>

</html>